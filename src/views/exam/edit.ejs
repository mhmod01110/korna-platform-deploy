<%- contentFor('body') %>

<div class="container">
    <div class="card">
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <h3 class="mb-0">تعديل الاختبار: <%= exam.title %></h3>
                <a href="/exams" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> العودة إلى الاختبارات
                </a>
            </div>
        </div>
        <div class="card-body">
            <form action="/exams/<%= exam._id %>/edit" method="POST" class="needs-validation" novalidate>
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">

                <!-- Basic Information -->
                <div class="mb-4">
                    <h5>المعلومات الأساسية</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="title" class="form-label">عنوان الاختبار</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="title" 
                                   name="title" 
                                   required
                                   minlength="3"
                                   maxlength="100"
                                   value="<%= exam.title %>">
                            <div class="invalid-feedback">
                                يجب أن يكون عنوان الاختبار بين 3 و 100 حرف.
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="type" class="form-label">نوع الاختبار</label>
                            <select class="form-select" id="type" name="type" required>
                                <option value="">اختر النوع</option>
                                <option value="MCQ" <%= exam.type === 'MCQ' ? 'selected' : '' %>>اختيار متعدد</option>
                                <option value="PROJECT" <%= exam.type === 'PROJECT' ? 'selected' : '' %>>مشروع</option>
                                <option value="MIXED" <%= exam.type === 'MIXED' ? 'selected' : '' %>>مختلط</option>
                            </select>
                            <div class="invalid-feedback">
                                يرجى اختيار نوع الاختبار.
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label">الوصف</label>
                        <textarea class="form-control" 
                                  id="description" 
                                  name="description" 
                                  rows="3"
                                  maxlength="500"><%= exam.description %></textarea>
                        <div class="form-text">
                            يرجى إعطاء وصف مختصر للاختبار (اختياري, أقصى 500 حرف).
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="department" class="form-label">الدرس</label>
                            <select class="form-select" id="department" name="department" required>
                                <option value="">اختر الدرس</option>
                                <% departments.forEach(dept => { %>
                                    <option value="<%= dept._id %>" 
                                            <%= exam.department._id.toString() === dept._id.toString() ? 'selected' : '' %>>
                                        <%= dept.name %>
                                    </option>
                                <% }); %>
                            </select>
                            <div class="invalid-feedback">
                                يرجى اختيار الدرس.
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="duration" class="form-label">المدة (دقائق)</label>
                            <input type="number" 
                                   class="form-control" 
                                   id="duration" 
                                   name="duration" 
                                   required
                                   min="5"
                                   max="480"
                                   value="<%= exam.duration %>">
                            <div class="invalid-feedback">
                                يجب أن تكون المدة بين 5 و 480 دقيقة.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Schedule -->
                <div class="mb-4">
                    <h5>الجدول</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="startDate" class="form-label">تاريخ البدء والوقت</label>
                            <input type="datetime-local" 
                                   class="form-control" 
                                   id="startDate" 
                                   name="startDate"
                                   value="<%= new Date(exam.startDate).toISOString().slice(0, 16) %>"
                                   required>
                            <div class="invalid-feedback">
                                يرجى تحديد تاريخ البدء والوقت.
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="endDate" class="form-label">تاريخ الانتهاء والوقت</label>
                            <input type="datetime-local" 
                                   class="form-control" 
                                   id="endDate" 
                                   name="endDate" 
                                   value="<%= new Date(exam.endDate).toISOString().slice(0, 16) %>"
                                   required>
                            <div class="invalid-feedback">
                                يرجى تحديد تاريخ الانتهاء والوقت.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings -->
                <div class="mb-4">
                    <h5>الإعدادات</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="maxAttempts" class="form-label">المحاولات القصوى</label>
                            <input type="number" 
                                   class="form-control" 
                                   id="maxAttempts" 
                                   name="maxAttempts" 
                                   required
                                   min="1"
                                   value="<%= exam.maxAttempts %>">
                            <div class="invalid-feedback">
                                يجب أن تكون المحاولات القصوى على الأقل 1.
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <div class="form-check">
                            <input type="checkbox" 
                                   class="form-check-input" 
                                   id="shuffleQuestions" 
                                   name="shuffleQuestions"
                                   <%= exam.shuffleQuestions ? 'checked' : '' %>>
                            <label class="form-check-label" for="shuffleQuestions">
                                إختيار الأسئلة بشكل عشوائي
                            </label>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="resultDisplayOption" class="form-label">خيارات عرض النتائج للطلاب</label>
                        <select class="form-select" id="resultDisplayOption" name="resultDisplayOption" required>
                            <option value="HIDE_RESULTS" <%= exam.resultDisplayOption === 'HIDE_RESULTS' ? 'selected' : '' %>>عدم اظهار النتيجة للطالب</option>
                            <option value="SHOW_SCORE_ONLY" <%= exam.resultDisplayOption === 'SHOW_SCORE_ONLY' ? 'selected' : '' %>>اظهار فقط النتيجة النهائية للطالب</option>
                            <option value="SHOW_FULL_DETAILS" <%= exam.resultDisplayOption === 'SHOW_FULL_DETAILS' ? 'selected' : '' %>>اظهار النتيجة و تفاصيل الاجابات للطالب</option>
                        </select>
                        <div class="form-text">
                            اختر كيفية عرض النتائج للطلاب بعد انتهاء الاختبار.
                        </div>
                    </div>

                    <div class="mb-3">
                        <div class="form-check">
                            <input type="checkbox" 
                                   class="form-check-input" 
                                   id="isPublic" 
                                   name="isPublic"
                                   <%= exam.isPublic ? 'checked' : '' %>>
                            <label class="form-check-label" for="isPublic">
                                جعل الاختبار عام
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Instructions -->
                <div class="mb-4">
                    <h5>التعليمات</h5>
                    <textarea class="form-control" 
                              id="instructions" 
                              name="instructions" 
                              rows="4"><%= exam.instructions %></textarea>
                    <div class="form-text">
                        يرجى إعطاء تعليمات للطلاب الذين يأخذون الاختبار (اختياري).
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> تعديل الاختبار
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Form Validation Script -->
<script>
// Form validation
document.addEventListener('DOMContentLoaded', function() {
    // Form validation
    const form = document.querySelector('.needs-validation');
    form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
        form.classList.add('was-validated');
    });
});
</script> 