<div class="container mt-5">
    <% if (!user) { %>
        <!-- Guest View -->
        <div class="row justify-content-center">
            <div class="col-lg-6 col-md-8">
                <div class="modern-card text-center">
                    <div class="card-header gradient-primary">
                        <h2 class="mb-0">
                            <i class="fas fa-graduation-cap ms-2"></i>
                            أهلاً بك في منصة كورنا-ميستري
                        </h2>
                    </div>
                    <div class="card-body p-5">
                        <p class="lead mb-4">أول منصة متكاملة من قلب الوادي الجديد</p>
                        <div class="row g-3">
                            <div class="col-12">
                                <a href="/auth/login" class="btn btn-primary btn-lg w-100">
                                    <i class="fas fa-sign-in-alt ms-2"></i>
                                    تسجيل الدخول
                                </a>
                            </div>
                            <div class="col-12">
                                <a href="/auth/register" class="btn btn-outline-primary btn-lg w-100">
                                    <i class="fas fa-user-plus ms-2"></i>
                                    إنشاء حساب جديد
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Features Section -->
                <div class="row mt-5">
                    <div class="col-md-4 mb-4">
                        <div class="text-center">
                            <div class="stats-card gradient-success">
                                <i class="fas fa-book fa-3x mb-3"></i>
                                <h5>اختبارات متنوعة</h5>
                                <p>اختبارات شاملة و تقييم أداء مستمر</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="text-center">
                            <div class="stats-card gradient-warning">
                                <i class="fas fa-mobile-alt fa-3x mb-3"></i>
                                <h5>مواد علمية شيقة</h5>
                                <p>لا يخرج عنها أي امتحان</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                      <div class="text-center">
                          <div class="stats-card gradient-info">
                              <i class="fas fa-chart-line fa-3x mb-3"></i>
                              <h5>تقارير مفصلة</h5>
                              <p>تقارير شاملة عن الأداء</p>
                          </div>
                      </div>
                  </div>
                </div>
            </div>
        </div>
    <% } else if (user.role === 'student') { %>
        <!-- Student Dashboard -->
        
        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="stats-card">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-book fa-2x"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h3><%= typeof upcomingExams !== 'undefined' ? upcomingExams.length : 0 %></h3>
                            <p>اختبارات حديثة</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="stats-card gradient-success">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-check-circle fa-2x"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <% const visibleResults = recentResults.filter(r => r.examId && r.examId.resultDisplayOption !== 'HIDE_RESULTS'); %>
                            <h3><%= visibleResults.filter(r => r.status === 'PASS').length %></h3>
                            <p>اختبارات مجتازة</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="stats-card gradient-info">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-chart-line fa-2x"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h3><%= visibleResults.length ? Math.round(visibleResults.reduce((sum, r) => sum + r.percentage, 0) / visibleResults.length) : 0 %>%</h3>
                            <p>متوسط الدرجات</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="stats-card gradient-warning">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-building fa-2x"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h3><%= departments.length %></h3>
                            <p>الدروس المتاحة</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="modern-card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-bolt ms-2"></i>
                            إجراءات سريعة
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <a href="/exams" class="btn btn-primary w-100 btn-lg">
                                    <i class="fas fa-book d-block fa-2x mb-2"></i>
                                    الاختبارات المتاحة
                                </a>
                            </div>
                            <div class="col-md-3 mb-3">
                                <a href="/departments" class="btn btn-info w-100 btn-lg">
                                    <i class="fas fa-building d-block fa-2x mb-2"></i>
                                    الدروس المتاحة
                                </a>
                            </div>
                            <div class="col-md-3 mb-3">
                                <a href="/profile" class="btn btn-success w-100 btn-lg">
                                    <i class="fas fa-user d-block fa-2x mb-2"></i>
                                    الملف الشخصي
                                </a>
                            </div>
                            <div class="col-md-3 mb-3">
                                <a href="/results-survey" class="btn btn-warning w-100 btn-lg">
                                    <i class="fas fa-chart-bar d-block fa-2x mb-2"></i>
                                    استطلاع النتائج
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Row -->
        <div class="row">
            <!-- Upcoming Exams -->
            <div class="col-lg-6 mb-4">
                <div class="modern-card h-100">
                    <div class="card-header gradient-primary">
                        <h5 class="mb-0">
                            <i class="fas fa-clock ms-2"></i>
                            الاختبارات الحديثة
                        </h5>
                    </div>
                    <div class="card-body">
                        <% if (typeof upcomingExams !== 'undefined' && upcomingExams.length > 0) { %>
                            <div class="list-group list-group-flush">
                                <% upcomingExams.forEach(exam => { %>
                                    <% if (exam.status === 'PUBLISHED') { %>
                                        <a href="/exams/<%= exam._id %>" class="list-group-item list-group-item-action border-0 px-0">
                                            <div class="d-flex w-100 justify-content-between align-items-center">
                                                <div>
                                                    <h6 class="mb-1"><%= exam.title %></h6>
                                                    <p class="mb-1 text-muted small">
                                                        <i class="fas fa-calendar ms-1"></i>
                                                        <%= new Date(exam.startDate).toLocaleDateString('ar-EG') %>
                                                    </p>
                                                </div>
                                                <div class="text-end">
                                                    <div class="mb-1">
                                                        <span class="badge bg-primary"><%= exam.duration %> دقيقة</span>
                                                    </div>
                                                    <div>
                                                        <span class="badge bg-success">منشور</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </a>
                                    <% } else { %>
                                        <div class="list-group-item border-0 px-0">
                                            <div class="d-flex w-100 justify-content-between align-items-center">
                                                <div>
                                                    <h6 class="mb-1"><%= exam.title %></h6>
                                                    <p class="mb-1 text-muted small">
                                                        <i class="fas fa-calendar ms-1"></i>
                                                        <%= new Date(exam.startDate).toLocaleDateString('ar-EG') %>
                                                    </p>
                                                </div>
                                                <div class="text-end">
                                                    <div class="mb-1">
                                                        <span class="badge bg-primary"><%= exam.duration %> دقيقة</span>
                                                    </div>
                                                    <div>
                                                        <% if (exam.status === 'DRAFT') { %>
                                                            <span class="badge bg-secondary">مسودة</span>
                                                        <% } else if (exam.status === 'IN_PROGRESS') { %>
                                                            <span class="badge bg-warning">قيد التنفيذ</span>
                                                        <% } else if (exam.status === 'COMPLETED') { %>
                                                            <span class="badge bg-info">مكتمل</span>
                                                        <% } else if (exam.status === 'ARCHIVED') { %>
                                                            <span class="badge bg-dark">مؤرشف</span>
                                                        <% } %>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    <% } %>
                                <% }) %>
                            </div>
                            <div class="text-center mt-3">
                                <a href="/exams" class="btn btn-outline-primary btn-sm">
                                    عرض جميع الاختبارات
                                </a>
                            </div>
                        <% } else { %>
                            <div class="text-center py-4">
                                <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                                <p class="text-muted">لا توجد اختبارات قادمة حالياً</p>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>

        <!-- Recent Results -->
        <div class="col-lg-6 mb-4">
            <div class="modern-card h-100">
                <div class="card-header gradient-success">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-line ms-2"></i>
                        النتائج الأخيرة
                    </h5>
                </div>
                <div class="card-body">
                    <% if (typeof recentResults !== 'undefined' && recentResults.length > 0) { %>
                        <div class="list-group list-group-flush">
                            <% recentResults.slice(0, 5).forEach(result => { %>
                                <% if (result.examId.resultDisplayOption === 'SHOW_FULL_DETAILS') { %>
                                    <a href="/exams/<%= result.examId._id %>/results/<%= result._id.toString() %>" 
                                       class="list-group-item list-group-item-action border-0 px-0">
                                        <div class="d-flex w-100 justify-content-between align-items-center">
                                            <div>
                                                <h6 class="mb-1"><%= result.examTitle %></h6>
                                                <p class="mb-1 text-muted small">
                                                    <i class="fas fa-calendar ms-1"></i>
                                                    <%= new Date(result.createdAt).toLocaleDateString('ar-EG') %>
                                                </p>
                                            </div>
                                            <div class="text-end">
                                                <span class="badge 
                                                    <%= result.status === 'PASS' 
                                                        ? 'bg-success' 
                                                        : result.status === 'UNDER_REVIEW' 
                                                            ? 'bg-warning text-dark' 
                                                            : 'bg-danger' %> fs-6">
        
                                                    <%= result.status === 'UNDER_REVIEW' 
                                                        ? 'قيد المراجعة' 
                                                        : result.percentage.toFixed(1) + '%' %>
                                                </span>
                                            </div>
                                        </div>
                                    </a>
                                <% } else if (result.examId.resultDisplayOption === 'SHOW_SCORE_ONLY') { %>
                                    <div class="list-group-item border-0 px-0">
                                        <div class="d-flex w-100 justify-content-between align-items-center">
                                            <div>
                                                <h6 class="mb-1"><%= result.examTitle %></h6>
                                                <p class="mb-1 text-muted small">
                                                    <i class="fas fa-calendar ms-1"></i>
                                                    <%= new Date(result.createdAt).toLocaleDateString('ar-EG') %>
                                                </p>
                                            </div>
                                            <div class="text-end">
                                                <span class="badge 
                                                    <%= result.status === 'PASS' 
                                                        ? 'bg-success' 
                                                        : result.status === 'UNDER_REVIEW' 
                                                            ? 'bg-warning text-dark' 
                                                            : 'bg-danger' %> fs-6">
        
                                                    <%= result.status === 'UNDER_REVIEW' 
                                                        ? 'قيد المراجعة' 
                                                        : (result.status === 'PASS' ? 'نجح' : 'فشل') %>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                <% } %>
                            <% }) %>
                        </div>
                    <% } else { %>
                        <div class="text-center py-4">
                            <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
                            <p class="text-muted">لا توجد نتائج حديثة</p>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>

        <!-- Departments Section -->
        <div class="row">
            <div class="col-12">
                <div class="modern-card">
                    <div class="card-header gradient-info">
                        <h5 class="mb-0">
                            <i class="fas fa-building ms-2"></i>
                            الدروس المتاحة
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <% departments.forEach(department => { %>
                                <div class="col-lg-4 col-md-6 mb-4">
                                    <div class="card h-100 border-0 shadow-sm">
                                        <div class="card-header bg-light">
                                            <h6 class="mb-0">
                                                <i class="fas fa-folder ms-2"></i>
                                                <%= department.name %>
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row mb-3">
                                                <div class="col-6">
                                                    <div class="text-center">
                                                        <h6 class="text-primary mb-0"><%= department.exams?.length || 0 %></h6>
                                                        <small class="text-muted">اختبارات</small>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="text-center">
                                                        <h6 class="text-success mb-0"><%= department.materials?.length || 0 %></h6>
                                                        <small class="text-muted">مواد</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="d-grid gap-2">
                                                <a href="/departments/<%= department._id %>/exams" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-book ms-1"></i> الاختبارات
                                                </a>
                                                <a href="/departments/<%= department._id %>/materials" class="btn btn-info btn-sm">
                                                    <i class="fas fa-file-alt ms-1"></i> المواد
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <% } else { %>
        <!-- Teacher/Admin Dashboard -->
        
        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="stats-card">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-book fa-2x"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h3><%= typeof totalExams !== 'undefined' ? totalExams : 0 %></h3>
                            <p>إجمالي الاختبارات</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="stats-card gradient-success">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-question-circle fa-2x"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h3><%= typeof totalQuestions !== 'undefined' ? totalQuestions : 0 %></h3>
                            <p>إجمالي الأسئلة</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="stats-card gradient-info">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-file-alt fa-2x"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h3><%= typeof totalSubmissions !== 'undefined' ? totalSubmissions : 0 %></h3>
                            <p>إجمالي التقديمات</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="stats-card gradient-warning">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-users fa-2x"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h3><%= typeof totalUsers !== 'undefined' ? totalUsers : 0 %></h3>
                            <p>إجمالي المستخدمين</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="modern-card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-bolt ms-2"></i>
                            إجراءات سريعة
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                                <a href="/exams/create" class="btn btn-primary w-100 btn-lg">
                                    <i class="fas fa-plus d-block fa-2x mb-2"></i>
                                     إنشاء اختبار جديد
                                </a>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                                <a href="/questions" class="btn btn-success w-100 btn-lg">
                                    <i class="fas fa-question-circle d-block fa-2x mb-2"></i>
                                    بنك الأسئلة الشامل
                                </a>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                                <a href="/departments/create" class="btn btn-info w-100 btn-lg">
                                    <i class="fas fa-building d-block fa-2x mb-2"></i>
                                   إضافة درس جديد
                                </a>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                                <a href="/admin/users" class="btn btn-warning w-100 btn-lg">
                                    <i class="fas fa-users d-block fa-2x mb-2"></i>
                                    إدارة المستخدمين
                                </a>
                            </div>
                                                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                            <a href="/admin/reports" class="btn btn-secondary w-100 btn-lg">
                                <i class="fas fa-chart-bar d-block fa-2x mb-2"></i>
                                التقارير العامة للمنصة
                            </a>
                        </div>
                            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                                <a href="/results-survey" class="btn btn-dark w-100 btn-lg">
                                    <i class="fas fa-poll d-block fa-2x mb-2"></i>
                                    استطلاع النتائج
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Row -->
        <div class="row">
            <!-- Recent Exams -->
            <div class="col-lg-6 mb-4">
                <div class="modern-card h-100">
                    <div class="card-header gradient-primary">
                        <h5 class="mb-0">
                            <i class="fas fa-clock ms-2"></i>
                            الاختبارات الأخيرة
                        </h5>
                    </div>
                    <div class="card-body">
                        <% if (typeof recentExams !== 'undefined' && recentExams.length > 0) { %>
                            <div class="list-group list-group-flush">
                                <% recentExams.slice(0, 5).forEach(exam => { %>
                                    <a href="/exams/<%= exam._id %>" class="list-group-item list-group-item-action border-0 px-0">
                                        <div class="d-flex w-100 justify-content-between align-items-center">
                                            <div>
                                                <h6 class="mb-1"><%= exam.title %></h6>
                                                <p class="mb-1 text-muted small">
                                                    <i class="fas fa-question ms-1"></i>
                                                    <%= exam.questions.length %> سؤال
                                                    <span class="mx-2">|</span>
                                                    <i class="fas fa-file-alt ms-1"></i>
                                                    <%= exam.submissions.length %> تقديم
                                                </p>
                                            </div>
                                            <div class="text-end">
                                                <span class="badge <%= 
                                                    exam.status === 'PUBLISHED' ? 'bg-success' : 
                                                    exam.status === 'DRAFT' ? 'bg-warning text-dark' : 
                                                    exam.status === 'ARCHIVED' ? 'bg-secondary' : 
                                                    'bg-primary' 
                                                %>">
                                                    <%= exam.status === 'PUBLISHED' ? 'منشور' :
                                                        exam.status === 'DRAFT' ? 'مسودة' :
                                                        exam.status === 'ARCHIVED' ? 'مؤرشف' :
                                                        exam.status %>
                                                </span>
                                            </div>
                                        </div>
                                    </a>
                                <% }) %>
                            </div>
                            <div class="text-center mt-3">
                                <a href="/exams" class="btn btn-outline-primary btn-sm">
                                    عرض جميع الاختبارات
                                </a>
                            </div>
                        <% } else { %>
                            <div class="text-center py-4">
                                <i class="fas fa-book fa-3x text-muted mb-3"></i>
                                <p class="text-muted">لم يتم إنشاء اختبارات بعد</p>
                                <a href="/exams/create" class="btn btn-primary btn-sm">
                                    <i class="fas fa-plus ms-1"></i>
                                    إنشاء اختبار جديد
                                </a>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>

            <!-- Hall of Fame -->
            <div class="col-lg-6 mb-4">
                <div class="modern-card h-100">
                    <div class="card-header gradient-info">
                        <h5 class="mb-0">
                            <i class="fas fa-trophy ms-2"></i>
                            لوحة الشرف
                        </h5>
                    </div>
                    <div class="card-body">
                        <% if (typeof topStudents !== 'undefined' && topStudents && topStudents.length > 0) { %>
                            <div class="hall-of-fame">
                                <% topStudents.forEach((student, index) => { %>
                                    <a href="/admin/users/students/<%= student._id %>" class="text-decoration-none">
                                        <div class="student-rank d-flex align-items-center mb-3 p-3 rounded bg-light border hover-shadow" 
                                             style="transition: all 0.2s; cursor: pointer;"
                                             onmouseover="this.style.backgroundColor='#e9ecef'; this.style.transform='translateY(-2px)'"
                                             onmouseout="this.style.backgroundColor='#f8f9fa'; this.style.transform='translateY(0)'">
                                            <div class="rank-badge ms-3">
                                                <% if (index === 0) { %>
                                                    <i class="fas fa-crown text-warning fs-4"></i>
                                                <% } else if (index === 1) { %>
                                                    <i class="fas fa-medal text-secondary fs-4"></i>
                                                <% } else if (index === 2) { %>
                                                    <i class="fas fa-award text-warning fs-4"></i>
                                                <% } else { %>
                                                    <span class="badge bg-primary rounded-circle fs-6"><%= index + 1 %></span>
                                                <% } %>
                                            </div>
                                            <div class="student-info flex-grow-1">
                                                <h6 class="mb-1 text-primary"><%= student.firstName %> <%= student.lastName %></h6>
                                                <div class="row">
                                                    <div class="col-4">
                                                        <small class="text-muted">
                                                            <i class="fas fa-clipboard-check ms-1"></i>
                                                            <%= student.examCount %> اختبار
                                                        </small>
                                                    </div>
                                                    <div class="col-4">
                                                        <small class="text-success fw-bold">
                                                            <i class="fas fa-star ms-1"></i>
                                                            <%= student.totalObtainedMarks %> نقطة
                                                        </small>
                                                    </div>
                                                    <div class="col-4">
                                                        <small class="text-info">
                                                            <i class="fas fa-percentage ms-1"></i>
                                                            <%= student.averagePercentage %>%
                                                        </small>
                                                    </div>
                                                </div>
                                                <div class="progress mt-2" style="height: 8px;">
                                                    <div class="progress-bar bg-success" 
                                                         role="progressbar"
                                                         data-width="<%= student.overallPercentage %>"
                                                         aria-valuenow="<%= student.overallPercentage %>"
                                                         aria-valuemin="0"
                                                         aria-valuemax="100">
                                                    </div>
                                                </div>
                                                <small class="text-muted">
                                                    إجمالي: <%= student.totalObtainedMarks %>/<%= student.totalPossibleMarks %> 
                                                    (<%= student.overallPercentage %>%)
                                                </small>
                                            </div>
                                            <div class="ms-auto">
                                                <i class="fas fa-chevron-left text-muted"></i>
                                            </div>
                                        </div>
                                    </a>
                                <% }); %>
                            </div>
                        <% } else { %>
                            <div class="text-center py-4">
                                <i class="fas fa-trophy text-muted fs-1 mb-3"></i>
                                <p class="text-muted">لا توجد نتائج حتى الآن</p>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>

        <!-- Departments Section -->
        <div class="row">
            <div class="col-12">
                <div class="modern-card">
                    <div class="card-header gradient-warning">
                        <h5 class="mb-0">
                            <i class="fas fa-building ms-2"></i>
                            إدارة الدروس
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <% departments.forEach(department => { %>
                                <div class="col-lg-4 col-md-6 mb-4">
                                    <div class="card h-100 border-0 shadow-sm">
                                        <div class="card-header bg-light">
                                            <h6 class="mb-0">
                                                <i class="fas fa-folder ms-2"></i>
                                                <%= department.name %>
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row mb-3">
                                                <div class="col-6">
                                                    <div class="text-center">
                                                        <h6 class="text-primary mb-0"><%= department.exams?.length || 0 %></h6>
                                                        <small class="text-muted">اختبارات</small>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="text-center">
                                                        <h6 class="text-success mb-0"><%= department.materials?.length || 0 %></h6>
                                                        <small class="text-muted">مواد</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="d-grid gap-2">
                                                <a href="/departments/<%= department._id %>/exams" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-book ms-1"></i> الاختبارات
                                                </a>
                                                <a href="/departments/<%= department._id %>/materials" class="btn btn-info btn-sm">
                                                    <i class="fas fa-file-alt ms-1"></i> المواد
                                                </a>
                                                <a href="/departments/<%= department._id %>/edit" class="btn btn-warning btn-sm">
                                                    <i class="fas fa-edit ms-1"></i> تعديل
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <% } %>
</div>

<!-- Custom CSS for timeline -->
<style>
    .timeline {
        position: relative;
        padding-left: 30px;
    }

    .timeline::before {
        content: '';
        position: absolute;
        left: 10px;
        top: 0;
        bottom: 0;
        width: 2px;
        background-color: #e9ecef;
    }

    .timeline-item {
        position: relative;
        margin-bottom: 20px;
    }

    .timeline-marker {
        position: absolute;
        left: -25px;
        top: 5px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 2px solid #fff;
        box-shadow: 0 0 0 2px #e9ecef;
    }

    .timeline-content {
        padding-left: 15px;
    }

    @media (max-width: 768px) {
        .stats-card h3 {
            font-size: 1.8rem;
        }
        
        .content-header h1 {
            font-size: 2rem;
        }
    }
</style>
<script>
// Initialize progress bars without inline width to satisfy linter
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.progress-bar[data-width]').forEach(function(el){
        const w = parseFloat(el.getAttribute('data-width')) || 0;
        el.style.width = w + '%';
    });
});
</script>
